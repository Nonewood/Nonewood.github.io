<!DOCTYPE html>



  


<html class="theme-next pisces use-motion" lang="zh-Hans">
<head><meta name="generator" content="Hexo 3.9.0">
  <meta charset="UTF-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">
<meta name="theme-color" content="#222">









<meta http-equiv="Cache-Control" content="no-transform">
<meta http-equiv="Cache-Control" content="no-siteapp">



  <meta name="google-site-verification" content="9HGY4GvHBQiYcf3ysSZmtQCkRadM6n5ZDPoYRlcr71E">














  
  
  <link href="/lib/fancybox/source/jquery.fancybox.css?v=2.1.5" rel="stylesheet" type="text/css">







<link href="/lib/font-awesome/css/font-awesome.min.css?v=4.6.2" rel="stylesheet" type="text/css">

<link href="/css/main.css?v=5.1.4" rel="stylesheet" type="text/css">


  <link rel="apple-touch-icon" sizes="180x180" href="/images/apple-touch-icon-next.png?v=5.1.4">


  <link rel="icon" type="image/png" sizes="32x32" href="/images/favicon-32x32-next.png?v=5.1.4">


  <link rel="icon" type="image/png" sizes="16x16" href="/images/favicon-16x16-next.png?v=5.1.4">


  <link rel="mask-icon" href="/images/logo.svg?v=5.1.4" color="#222">





  <meta name="keywords" content="Hexo, NexT">










<meta property="og:type" content="website">
<meta property="og:title" content="朝简单处想 往认真处行">
<meta property="og:url" content="http://nonewood.github.io/index.html">
<meta property="og:site_name" content="朝简单处想 往认真处行">
<meta property="og:locale" content="zh-Hans">
<meta name="twitter:card" content="summary">
<meta name="twitter:title" content="朝简单处想 往认真处行">



<script type="text/javascript" id="hexo.configurations">
  var NexT = window.NexT || {};
  var CONFIG = {
    root: '/',
    scheme: 'Pisces',
    version: '5.1.4',
    sidebar: {"position":"left","display":"post","offset":12,"b2t":false,"scrollpercent":false,"onmobile":false},
    fancybox: true,
    tabs: true,
    motion: {"enable":true,"async":false,"transition":{"post_block":"fadeIn","post_header":"slideDownIn","post_body":"slideDownIn","coll_header":"slideLeftIn","sidebar":"slideUpIn"}},
    duoshuo: {
      userId: '0',
      author: '博主'
    },
    algolia: {
      applicationID: '',
      apiKey: '',
      indexName: '',
      hits: {"per_page":10},
      labels: {"input_placeholder":"Search for Posts","hits_empty":"We didn't find any results for the search: ${query}","hits_stats":"${hits} results found in ${time} ms"}
    }
  };
</script>



  <link rel="canonical" href="http://nonewood.github.io/">





<script data-ad-client="ca-pub-7093029654692281" async src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
<script>
     (adsbygoogle = window.adsbygoogle || []).push({
          google_ad_client: "ca-pub-7126877795421398",
          enable_page_level_ads: true
     });
</script>

  <title>朝简单处想 往认真处行</title>
  








</head>

<body itemscope itemtype="http://schema.org/WebPage" lang="zh-Hans">

  
  
    
  

  <div class="container sidebar-position-left 
  page-home">
    <div class="headband"></div>

    <header id="header" class="header" itemscope itemtype="http://schema.org/WPHeader">
      <div class="header-inner"><div class="site-brand-wrapper">
  <div class="site-meta ">
    

    <div class="custom-logo-site-title">
      <a href="/" class="brand" rel="start">
        <span class="logo-line-before"><i></i></span>
        <span class="site-title">朝简单处想 往认真处行</span>
        <span class="logo-line-after"><i></i></span>
      </a>
    </div>
      
        <p class="site-subtitle"></p>
      
  </div>

  <div class="site-nav-toggle">
    <button>
      <span class="btn-bar"></span>
      <span class="btn-bar"></span>
      <span class="btn-bar"></span>
    </button>
  </div>
</div>

<nav class="site-nav">
  

  
    <ul id="menu" class="menu">
      
        
        <li class="menu-item menu-item-home">
          <a href="/" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-home"></i> <br>
            
            首页
          </a>
        </li>
      
        
        <li class="menu-item menu-item-tags">
          <a href="/tags/" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-tags"></i> <br>
            
            标签
          </a>
        </li>
      
        
        <li class="menu-item menu-item-categories">
          <a href="/categories/" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-th"></i> <br>
            
            分类
          </a>
        </li>
      
        
        <li class="menu-item menu-item-archives">
          <a href="/archives/" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-archive"></i> <br>
            
            归档
          </a>
        </li>
      

      
    </ul>
  

  
</nav>



 </div>
    </header>

    <main id="main" class="main">
      <div class="main-inner">
        <div class="content-wrap">
          <div id="content" class="content">
            
  <section id="posts" class="posts-expand">
    
      

  

  
  
  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://nonewood.github.io/2022/01/30/weixin-sougou/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="Nonewood">
      <meta itemprop="description" content>
      <meta itemprop="image" content="/images/avatar.gif">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="朝简单处想 往认真处行">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2022/01/30/weixin-sougou/" itemprop="url">一年（大概）前看过某个公众号的某个文章，但是我忘了…</a></h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              
              <time title="创建于" itemprop="dateCreated datePublished" datetime="2022-01-30T09:37:19+08:00">
                2022-01-30
              </time>
            

            

            
          </span>

          

          
            
          

          
          

          

          
            <div class="post-wordcount">
              
                
                <span class="post-meta-item-icon">
                  <i class="fa fa-file-word-o"></i>
                </span>
                
                  <span class="post-meta-item-text">字数统计&#58;</span>
                
                <span title="字数统计">
                  508 字
                </span>
              

              
                <span class="post-meta-divider">|</span>
              

              
                <span class="post-meta-item-icon">
                  <i class="fa fa-clock-o"></i>
                </span>
                
                  <span class="post-meta-item-text">阅读时长 &asymp;</span>
                
                <span title="阅读时长">
                  2 分钟
                </span>
              
            </div>
          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <h3 id="写在前边"><a href="#写在前边" class="headerlink" title="写在前边"></a>写在前边</h3><p>1）先说问题：大概去年某个时间在微信上看过一篇文章，当时候觉得有意思，但是没有收藏；只记得几个关键字，想用微信直接搜，结果又太多了；就…「想得却不可得，你奈人生何？」<br>2）好在搜狗可以搜微信文章，大概是这样，就想试着用程序爬一下：<br>3）结论：方法是成功了，结果却没有拿到，原因在于搜狗貌似搜索没有检索到微信这篇文章（叹气），就简单记录下爬取搜的方法吧。</p>
<h3 id="代码"><a href="#代码" class="headerlink" title="代码"></a>代码</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br></pre></td><td class="code"><pre><span class="line">import sys</span><br><span class="line">import time</span><br><span class="line">import re</span><br><span class="line">from bs4 import BeautifulSoup</span><br><span class="line">from selenium import webdriver</span><br><span class="line">import pandas as pd</span><br><span class="line"></span><br><span class="line"># 登陆, 不然只能查 10 页的搜索结果</span><br><span class="line">driver = webdriver.Firefox() # 这里一定要用火狐的驱动，chrome 的登陆后会被识别... </span><br><span class="line">url = &apos;https://weixin.sogou.com&apos;</span><br><span class="line">driver.get(url)</span><br><span class="line">time.sleep(5)</span><br><span class="line">driver.find_element_by_id(&apos;loginBtn&apos;).click()</span><br><span class="line">time.sleep(10)</span><br><span class="line"></span><br><span class="line"># 翻页，并且获取每页的公众号和链接（貌似只返回 100 页）</span><br><span class="line">df = pd.DataFrame(columns = [&apos;name&apos;, &apos;link&apos;])</span><br><span class="line">keyword = &apos;南京 买房 规划局&apos;</span><br><span class="line">for page_number in range(0, sys.maxsize):</span><br><span class="line">    print(page_number)</span><br><span class="line">    time.sleep(10)</span><br><span class="line">    url = &apos;https://weixin.sogou.com/weixin?query=&apos;+keyword+&apos;&amp;s_from=input&amp;_sug_=y&amp;type=2&amp;page=&apos;+str(page_number)+&apos;&amp;ie=utf8&apos;</span><br><span class="line">    driver.get(url)</span><br><span class="line">    soup = BeautifulSoup(driver.page_source, &quot;html.parser&quot;)</span><br><span class="line">    contents = soup.find_all(class_ = &quot;txt-box&quot;)</span><br><span class="line">    for content in contents:</span><br><span class="line">        content_dict = dict()</span><br><span class="line">        link_and_name = content.find_all(&apos;a&apos;)</span><br><span class="line">        link = link_and_name[0][&apos;href&apos;]</span><br><span class="line">        name = link_and_name[1].text</span><br><span class="line">        content_dict[&apos;name&apos;] = name</span><br><span class="line">        content_dict[&apos;link&apos;] = link</span><br><span class="line">        df = df.append(content_dict, ignore_index = True)</span><br><span class="line"></span><br><span class="line"># 然后去看有没有自己想要的公众号；</span><br></pre></td></tr></table></figure>

<h3 id="写在后边"><a href="#写在后边" class="headerlink" title="写在后边"></a>写在后边</h3><p>1）上边的脚本还是有些问题，比如如果短时间翻页太多，会让你输验证码；拿到的链接其实不是真实公众号文章的链接，需要再做一下处理，时间关系，我就没有实现，相应的一些解决办法在参考链接里；<br>2）看到好的文章，句子啊，记得平时做好记录；</p>
<h3 id="参考链接"><a href="#参考链接" class="headerlink" title="参考链接"></a>参考链接</h3><p><a href="https://blog.csdn.net/m0_46521785/article/details/113776386" target="_blank" rel="noopener">https://blog.csdn.net/m0_46521785/article/details/113776386</a><br><a href="https://www.pythonf.cn/read/129313" target="_blank" rel="noopener">https://www.pythonf.cn/read/129313</a><br><a href="https://segmentfault.com/a/1190000023622107" target="_blank" rel="noopener">https://segmentfault.com/a/1190000023622107</a></p>

          
        
      
    </div>
    
    
    

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://nonewood.github.io/2022/01/27/python-pdf-web/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="Nonewood">
      <meta itemprop="description" content>
      <meta itemprop="image" content="/images/avatar.gif">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="朝简单处想 往认真处行">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2022/01/27/python-pdf-web/" itemprop="url">Python 爬取网页 PDF 文本</a></h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              
              <time title="创建于" itemprop="dateCreated datePublished" datetime="2022-01-27T20:50:40+08:00">
                2022-01-27
              </time>
            

            

            
          </span>

          

          
            
          

          
          

          

          
            <div class="post-wordcount">
              
                
                <span class="post-meta-item-icon">
                  <i class="fa fa-file-word-o"></i>
                </span>
                
                  <span class="post-meta-item-text">字数统计&#58;</span>
                
                <span title="字数统计">
                  595 字
                </span>
              

              
                <span class="post-meta-divider">|</span>
              

              
                <span class="post-meta-item-icon">
                  <i class="fa fa-clock-o"></i>
                </span>
                
                  <span class="post-meta-item-text">阅读时长 &asymp;</span>
                
                <span title="阅读时长">
                  2 分钟
                </span>
              
            </div>
          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <h3 id="写在开头"><a href="#写在开头" class="headerlink" title="写在开头"></a>写在开头</h3><p><strong>问题：</strong>有时候会碰到有意思的研报/论文，为网页 pdf 文档，想要抓取其中的某些信息， 手动摘录的话，又太慢了；<br>问题存在的唯一意义就是 「解决它」；<br>简单记录下；</p>
<h3 id="代码"><a href="#代码" class="headerlink" title="代码"></a>代码</h3><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> requests</span><br><span class="line"><span class="keyword">from</span> io <span class="keyword">import</span> StringIO, BytesIO</span><br><span class="line"><span class="keyword">from</span> pdfminer.converter <span class="keyword">import</span> TextConverter</span><br><span class="line"><span class="keyword">from</span> pdfminer.pdfinterp <span class="keyword">import</span> PDFPageInterpreter, PDFResourceManager</span><br><span class="line"><span class="keyword">from</span> pdfminer.pdfpage <span class="keyword">import</span> PDFPage</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">get_score</span><span class="params">(url)</span>:</span></span><br><span class="line">    pdf_content = BytesIO(requests.get(url).content)</span><br><span class="line">    row = dict()</span><br><span class="line">    resource_manager = PDFResourceManager()</span><br><span class="line">    fake_file_handle = StringIO()</span><br><span class="line">    converter = TextConverter(resource_manager, fake_file_handle)   </span><br><span class="line">    page_interpreter = PDFPageInterpreter(resource_manager, converter)</span><br><span class="line">    <span class="comment"># 这里是在翻页</span></span><br><span class="line">    <span class="keyword">for</span> page <span class="keyword">in</span> PDFPage.get_pages(pdf_content,</span><br><span class="line">                            caching=<span class="literal">True</span>,</span><br><span class="line">                            check_extractable=<span class="literal">True</span>):</span><br><span class="line">        page_interpreter.process_page(page)</span><br><span class="line">        <span class="comment"># 我这里只取了第一页</span></span><br><span class="line">        <span class="keyword">break</span></span><br><span class="line">	  <span class="comment"># 获取第一页的内容</span></span><br><span class="line">    text = fake_file_handle.getvalue()</span><br><span class="line">    <span class="comment"># 这里做文本的处理即可</span></span><br><span class="line">    <span class="keyword">return</span> text</span><br></pre></td></tr></table></figure>

<h3 id="写在结尾"><a href="#写在结尾" class="headerlink" title="写在结尾"></a>写在结尾</h3><p>摘录书里的一个小片段，每天学习一点点：</p>
<blockquote>
<p>大约在我15岁的时候，我们全家去太阳谷滑雪；假期的最后那天，爸爸和我冒着风雪开车出去，他绕了十分钟的路去给我们开的那辆红色吉普车加油。当时他正争分夺秒地让我们全家能赶得上回家的飞机呢，所以到加油站后当我发现油箱里还有半箱油时，我感到很吃惊。<strong>我问爸爸，还有那么多汽油，我们为什么要停下来；他教导我说：“查理，你要是借了别人的车，别忘了加满油再还给人家。”</strong></p>
<p>我在斯坦福念大一时，有个熟人把车借给我。倒不是因为他跟我关系很好，而是因为一个我们都认识的朋友迫使他这么做。那辆奥迪佛克斯是红色的，油箱里还有一半油。所以我想起了吉普车的事，先把油加满了，再将车还回去。他发现了。自那以后，我们共同度过了很多美好的时光，我结婚的时候，他是我的伴郎。</p>
<p>从斯坦福毕业之后，我才知道当年度假时我们住的是瑞克·格伦的房子，开的是瑞克·格伦的吉普。瑞克是爸爸的朋友，当他回到太阳谷，就算吉普车的汽油比他离开的时候少，他也自然不会介意，甚至可能都不会发现。但爸爸无论什么事情都做得公平和周到。所以那天我不仅学到了如何交朋友，还学到了如何维护友谊。</p>
</blockquote>

          
        
      
    </div>
    
    
    

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://nonewood.github.io/2022/01/24/etf-plot/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="Nonewood">
      <meta itemprop="description" content>
      <meta itemprop="image" content="/images/avatar.gif">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="朝简单处想 往认真处行">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2022/01/24/etf-plot/" itemprop="url">画了几个ETF的图</a></h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              
              <time title="创建于" itemprop="dateCreated datePublished" datetime="2022-01-24T01:58:40+08:00">
                2022-01-24
              </time>
            

            

            
          </span>

          

          
            
          

          
          

          

          
            <div class="post-wordcount">
              
                
                <span class="post-meta-item-icon">
                  <i class="fa fa-file-word-o"></i>
                </span>
                
                  <span class="post-meta-item-text">字数统计&#58;</span>
                
                <span title="字数统计">
                  444 字
                </span>
              

              
                <span class="post-meta-divider">|</span>
              

              
                <span class="post-meta-item-icon">
                  <i class="fa fa-clock-o"></i>
                </span>
                
                  <span class="post-meta-item-text">阅读时长 &asymp;</span>
                
                <span title="阅读时长">
                  2 分钟
                </span>
              
            </div>
          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <h3 id="写在开头"><a href="#写在开头" class="headerlink" title="写在开头"></a>写在开头</h3><p>做几个 ETF 的数据，记录一下；<br>想尽量复现自己见到的不错的数据；</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line">import pandas as pd</span><br><span class="line">import requests, json</span><br><span class="line"></span><br><span class="line">def get_price(code, start_date, end_date):</span><br><span class="line">    url = &apos;https://q.stock.sohu.com/hisHq?code=cn_%s&amp;start=%s&amp;end=%s&amp;stat=1&amp;order=D&amp;period=d&amp;callback=historySearchHandler&amp;rt=jsonp&amp;r=0.5903327949924708&amp;0.9198253567636039&apos; % (code, start_date, end_date)</span><br><span class="line">    response = requests.get(url)</span><br><span class="line">    #import pdb; pdb.set_trace()</span><br><span class="line">    json_content = json.loads(response.text.strip(&apos;\n&apos;).strip(&apos;historySearchHandler(&apos;).strip(&apos;)&apos;))[0][&apos;hq&apos;]</span><br><span class="line">    df = pd.DataFrame(columns = &quot;日期	开盘	收盘	涨跌额	涨跌幅	最低	最高	成交量(手)	成交金额(万)&quot;.split(&quot;\t&quot;))</span><br><span class="line">    for info in json_content:</span><br><span class="line">        column_dict = &#123;&apos;日期&apos;: info[0], &apos;开盘&apos;: info[1], &apos;收盘&apos;: info[2], &apos;涨跌额&apos;: info[3], &apos;涨跌幅&apos;: info[4], &apos;最低&apos;: info[5], &apos;最高&apos;: info[6], &apos;成交量(手)&apos;: info[7], &apos;成交金额(万)&apos;: info[8]&#125;</span><br><span class="line">        df = df.append(column_dict, ignore_index = True)</span><br><span class="line">    df[&apos;日期&apos;] = pd.to_datetime(df[&apos;日期&apos;])</span><br><span class="line">    #df.index = pd.to_datetime(df[&apos;日期&apos;])</span><br><span class="line">    return df</span><br><span class="line"></span><br><span class="line"># eg</span><br><span class="line">df_513130 = get_price(&apos;513130&apos;, &apos;20190101&apos;, &apos;20220121&apos;)</span><br><span class="line"></span><br><span class="line"># 然后画图</span><br></pre></td></tr></table></figure>

<h3 id="结果"><a href="#结果" class="headerlink" title="结果"></a>结果</h3><p><strong>2021年以来</strong><br>见参考链接</p>
<p><strong>全部时间</strong><br>见参考链接</p>
<h3 id="结尾"><a href="#结尾" class="headerlink" title="结尾"></a>结尾</h3><p>摘录今天书里看到一句话</p>
<blockquote>
<p><strong>运气和交易有关吗？</strong><br>交易和其他任何工作一样。你刻苦努力，付出时间和精力，你的运气自然就来了。我在首笔100手交易中非常幸运地成为赢家，但我为什么会有好运呢？因为之前我能一整天站在交易所内，不断观察学习，六个多月天天如此，从而形成和提升了我的市场感觉。机会一旦来临，我就不会迟疑，能立刻把握。机会和运气只留给有准备的人。</p>
</blockquote>
<h3 id="参考链接"><a href="#参考链接" class="headerlink" title="参考链接"></a>参考链接</h3><p><a href="https://mp.weixin.qq.com/s/pUBfuXdX_GQ-yXJxMPp6TA" target="_blank" rel="noopener">https://mp.weixin.qq.com/s/pUBfuXdX_GQ-yXJxMPp6TA</a></p>

          
        
      
    </div>
    
    
    

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://nonewood.github.io/2022/01/16/tdx-to-python/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="Nonewood">
      <meta itemprop="description" content>
      <meta itemprop="image" content="/images/avatar.gif">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="朝简单处想 往认真处行">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2022/01/16/tdx-to-python/" itemprop="url">朋友说他有个致富公式… 让我给看看</a></h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              
              <time title="创建于" itemprop="dateCreated datePublished" datetime="2022-01-16T10:35:26+08:00">
                2022-01-16
              </time>
            

            

            
          </span>

          

          
            
          

          
          

          

          
            <div class="post-wordcount">
              
                
                <span class="post-meta-item-icon">
                  <i class="fa fa-file-word-o"></i>
                </span>
                
                  <span class="post-meta-item-text">字数统计&#58;</span>
                
                <span title="字数统计">
                  731 字
                </span>
              

              
                <span class="post-meta-divider">|</span>
              

              
                <span class="post-meta-item-icon">
                  <i class="fa fa-clock-o"></i>
                </span>
                
                  <span class="post-meta-item-text">阅读时长 &asymp;</span>
                
                <span title="阅读时长">
                  3 分钟
                </span>
              
            </div>
          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <h3 id="写在开头"><a href="#写在开头" class="headerlink" title="写在开头"></a>写在开头</h3><p>主要实现的东西是：<br>1）朋友给了个通达信公式，想看能不能致富；<br>2）手动去执行选股肉眼观察，效果还行；<br>3）有文化的我们知道只凭肉眼看肯定不靠谱，就想回测看看效果，就去测了；</p>
<p>涉及知识点：通达信的公式编辑，选股，以及bigquant上的回测</p>
<h3 id="通达信看效果貌似还行"><a href="#通达信看效果貌似还行" class="headerlink" title="通达信看效果貌似还行"></a>通达信看效果貌似还行</h3><p>选股公式是这样子的：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">DIFF:=EMA(CLOSE,12) - EMA(CLOSE,26);</span><br><span class="line">DEA:= EMA(DIFF,9);</span><br><span class="line">MACD:= 2*(DIFF-DEA);</span><br><span class="line">REF(C&lt;=O,2) AND REF(H&lt;REF(H,1) AND L&lt;REF(L,1),1) AND L&gt;REF(L,1) AND C&gt;O AND C&gt;REF(H,2) AND REF(EVERY(C/REF(C,1)&lt;1,3),3) AND DIFF&gt;0 AND DEA&gt;0;</span><br></pre></td></tr></table></figure>

<p>打开通达信，Ctrl + F , 条件选股， 新建公式<br>把这个公式粘贴进去， 测试公式， 保存<br>[图片见文末参考链接]</p>
<p>Ctrl  T,  选择刚建好的公式，执行选股，多试几个日期，发现，哎呦不错；<br>[图片见文末参考链接]</p>
<h3 id="那么回测试试呢？"><a href="#那么回测试试呢？" class="headerlink" title="那么回测试试呢？"></a>那么回测试试呢？</h3><p>首先需要将通达信公式语言转化成 python 语言；<br>回测平台选的是 bigquant, 因为我自己相对比较熟；<br>翻译的过程中要是有不懂的语句，网上查下（文末附链接）；<br>然后核对的时候看选出的股票能不能对上，就能知道有没有转化正确；</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"># 通达信公式</span><br><span class="line">DIFF:=EMA(CLOSE,12) - EMA(CLOSE,26);</span><br><span class="line">DEA:= EMA(DIFF,9);</span><br><span class="line">MACD:= 2*(DIFF-DEA);</span><br><span class="line">REF(C&lt;=O,2) AND REF(H&lt;REF(H,1) AND L&lt;REF(L,1),1) AND L&gt;REF(L,1) AND C&gt;O AND C&gt;REF(H,2) AND REF(EVERY(C/REF(C,1)&lt;1,3),3) AND DIFF&gt;0 AND DEA&gt;0;</span><br><span class="line"></span><br><span class="line"># python</span><br><span class="line">x.close_2 &lt;= x.open_2 and (x.high_1 &lt; x.high_2 and x.low_1 &lt; x.low_2) and x.low_0 &gt; x.low_1 and x.close_0 &gt; x.open_0 and x.close_0 &gt; x.high_2 and x.close_5 &lt; x.close_6 and x.close_4 &lt; x.close_5 and x.close_3 &lt; x.close_4 and (x.dif &gt; 0 and x.dea &gt;0)</span><br></pre></td></tr></table></figure>

<p><strong>Bigquant 实现</strong><br>Bigquant最后实现的效果如下，下边挑重点的截图简单说一下<br>[图片见文末参考链接]</p>
<p>1）特征列表，需要把公式里涉及的特征都体现在特征列表里边<br>[图片见文末参考链接]<br>2）自定义python模块中生成一下信号<br>[图片见文末参考链接]<br>3）回测函数中定义好自己的回测逻辑就可以回测了</p>
<p><strong>回测结果</strong><br>[图片见文末参考链接]</p>
<h3 id="写在后边"><a href="#写在后边" class="headerlink" title="写在后边"></a>写在后边</h3><p>真正能拿到财富代码的公式肯定不会这么简单，这篇只是方法的记录文章罢了；<br>转化公式的时候发现貌似没有通达信公式-&gt; python语言的现成工具，感觉可以做一个；</p>
<h3 id="参考链接"><a href="#参考链接" class="headerlink" title="参考链接"></a>参考链接</h3><p>通达信公式<br><a href="https://www.agudashi.cn/doc/5bffb706e7de95c78c41dd3c.html" target="_blank" rel="noopener">https://www.agudashi.cn/doc/5bffb706e7de95c78c41dd3c.html</a><br>公众号文章链接<br><a href="https://mp.weixin.qq.com/s?__biz=MzI0NTY3MjY0OA==&mid=2247483958&idx=1&sn=aa7b875e3a31dbbdc146fd73a776b856&chksm=e94bbd91de3c3487b3dbc769890c90a6284b5607b400716c068032e86d32585829ee572c0a6f&token=1620949572&lang=zh_CN#rd" target="_blank" rel="noopener">朋友说他有个致富公式… 让我给看看</a></p>

          
        
      
    </div>
    
    
    

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://nonewood.github.io/2022/01/15/xueqiu-performance-accum-rate/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="Nonewood">
      <meta itemprop="description" content>
      <meta itemprop="image" content="/images/avatar.gif">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="朝简单处想 往认真处行">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2022/01/15/xueqiu-performance-accum-rate/" itemprop="url">雪球模拟组合收益率爬取</a></h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              
              <time title="创建于" itemprop="dateCreated datePublished" datetime="2022-01-15T10:33:56+08:00">
                2022-01-15
              </time>
            

            

            
          </span>

          

          
            
          

          
          

          

          
            <div class="post-wordcount">
              
                
                <span class="post-meta-item-icon">
                  <i class="fa fa-file-word-o"></i>
                </span>
                
                  <span class="post-meta-item-text">字数统计&#58;</span>
                
                <span title="字数统计">
                  559 字
                </span>
              

              
                <span class="post-meta-divider">|</span>
              

              
                <span class="post-meta-item-icon">
                  <i class="fa fa-clock-o"></i>
                </span>
                
                  <span class="post-meta-item-text">阅读时长 &asymp;</span>
                
                <span title="阅读时长">
                  2 分钟
                </span>
              
            </div>
          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <h3 id="实现的功能："><a href="#实现的功能：" class="headerlink" title="实现的功能："></a>实现的功能：</h3><p>1）爬取雪球组合六个月以内，每天的累积收益率值（时间比六个月长就不给提供每天的累积收益率了）；<br>2）每天收盘后爬取当天的累积收益率；<br>3）延伸 1：把上边两点加起来就能一直跟踪组合的收益率了；<br>4）延伸 2：设置定时脚本，写程序定时执行上边的三个步骤，就可以每天只看一眼，时间变得简单一点点；</p>
<h3 id="代码"><a href="#代码" class="headerlink" title="代码"></a>代码</h3><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> requests,json</span><br><span class="line"></span><br><span class="line"><span class="comment"># 获取六个月内的每天累计收益率</span></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">get_return_rate_six_month</span><span class="params">(gid, cookie)</span>:</span></span><br><span class="line">    headers = &#123;</span><br><span class="line">        <span class="string">'authority'</span>: <span class="string">'tc.xueqiu.com'</span>,</span><br><span class="line">        <span class="string">'sec-ch-ua'</span>: <span class="string">'" Not A;Brand";v="99", "Chromium";v="96", "Google Chrome";v="96"'</span>,</span><br><span class="line">        <span class="string">'accept'</span>: <span class="string">'application/json, text/plain, */*'</span>,</span><br><span class="line">        <span class="string">'sec-ch-ua-mobile'</span>: <span class="string">'?0'</span>,</span><br><span class="line">        <span class="string">'user-agent'</span>: <span class="string">'Mozilla/5.0 (Windows NT 6.1; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/96.0.4664.45 Safari/537.36'</span>,</span><br><span class="line">        <span class="string">'sec-ch-ua-platform'</span>: <span class="string">'"Windows"'</span>,</span><br><span class="line">        <span class="string">'origin'</span>: <span class="string">'https://xueqiu.com'</span>,</span><br><span class="line">        <span class="string">'sec-fetch-site'</span>: <span class="string">'same-site'</span>,</span><br><span class="line">        <span class="string">'sec-fetch-mode'</span>: <span class="string">'cors'</span>,</span><br><span class="line">        <span class="string">'sec-fetch-dest'</span>: <span class="string">'empty'</span>,</span><br><span class="line">        <span class="string">'referer'</span>: <span class="string">'https://xueqiu.com/performance'</span>,</span><br><span class="line">        <span class="string">'accept-language'</span>: <span class="string">'zh-CN,zh;q=0.9,en;q=0.8,zh-TW;q=0.7'</span>,</span><br><span class="line">        <span class="string">'cookie'</span>: cookie,</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    params = ( </span><br><span class="line">        (<span class="string">'gid'</span>, gid),  </span><br><span class="line">        (<span class="string">'period'</span>, <span class="string">'6m'</span>), <span class="comment"># 每次取最大就行, 时间再长不给返回每天的累计收益率...</span></span><br><span class="line">        (<span class="string">'market'</span>, <span class="string">'ALL'</span>),</span><br><span class="line">    )</span><br><span class="line"></span><br><span class="line">    response = requests.get(<span class="string">'https://tc.xueqiu.com/tc/snowx/MONI/forchart/roa.json'</span>, headers=headers, params=params)</span><br><span class="line">    content = json.loads(response.text)</span><br><span class="line">    <span class="keyword">return</span> content[<span class="string">'result_data'</span>][<span class="string">'list'</span>]</span><br><span class="line"></span><br><span class="line">res= pd.DataFrame()</span><br><span class="line">gid = <span class="string">'your gid'</span></span><br><span class="line">cookie = <span class="string">'your cookies'</span></span><br><span class="line">data = get_return_rate(gid)</span><br><span class="line"><span class="keyword">for</span> element <span class="keyword">in</span> data:</span><br><span class="line">    value_dict = dict()</span><br><span class="line">    value_dict[<span class="string">'return_rate'</span>] = element[<span class="string">'value'</span>]</span><br><span class="line">    value_dict[<span class="string">'date'</span>] = element[<span class="string">'date'</span>]  </span><br><span class="line">    res= ers.append(value_dict, ignore_index = <span class="literal">True</span>)</span><br><span class="line">res.head()</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment"># 获取每天的累积收益率</span></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">get_accum_rate_each_day</span><span class="params">(gid, cookie)</span>:</span></span><br><span class="line">    headers = &#123;</span><br><span class="line">        <span class="string">'authority'</span>: <span class="string">'tc.xueqiu.com'</span>,</span><br><span class="line">        <span class="string">'sec-ch-ua'</span>: <span class="string">'" Not A;Brand";v="99", "Chromium";v="96", "Google Chrome";v="96"'</span>,</span><br><span class="line">        <span class="string">'accept'</span>: <span class="string">'application/json, text/plain, */*'</span>,</span><br><span class="line">        <span class="string">'sec-ch-ua-mobile'</span>: <span class="string">'?0'</span>,</span><br><span class="line">        <span class="string">'user-agent'</span>: <span class="string">'Mozilla/5.0 (Windows NT 6.1; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/96.0.4664.45 Safari/537.36'</span>,</span><br><span class="line">        <span class="string">'sec-ch-ua-platform'</span>: <span class="string">'"Windows"'</span>,</span><br><span class="line">        <span class="string">'origin'</span>: <span class="string">'https://xueqiu.com'</span>,</span><br><span class="line">        <span class="string">'sec-fetch-site'</span>: <span class="string">'same-site'</span>,</span><br><span class="line">        <span class="string">'sec-fetch-mode'</span>: <span class="string">'cors'</span>,</span><br><span class="line">        <span class="string">'sec-fetch-dest'</span>: <span class="string">'empty'</span>,</span><br><span class="line">        <span class="string">'referer'</span>: <span class="string">'https://xueqiu.com/performance'</span>,</span><br><span class="line">        <span class="string">'accept-language'</span>: <span class="string">'zh-CN,zh;q=0.9,en;q=0.8,zh-TW;q=0.7'</span>,</span><br><span class="line">        <span class="string">'cookie'</span>: cookie,</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    params = (</span><br><span class="line">        (<span class="string">'gid'</span>, gid),</span><br><span class="line">    )</span><br><span class="line"></span><br><span class="line">    response = requests.get(<span class="string">'https://tc.xueqiu.com/tc/snowx//MONI/performances.json'</span>, headers=headers, params=params)</span><br><span class="line"></span><br><span class="line">    response.encoding = <span class="string">"utf-8"</span></span><br><span class="line">    content = json.loads(response.text)</span><br><span class="line">    <span class="keyword">if</span> content[<span class="string">'msg'</span>] == <span class="string">'请求超时，请检查网络并重试'</span>:</span><br><span class="line">        print(<span class="string">"请求错误...需要更新 cookies... "</span>)</span><br><span class="line">        <span class="keyword">return</span></span><br><span class="line"></span><br><span class="line">    accum_rate = content[<span class="string">'result_data'</span>][<span class="string">'performances'</span>][<span class="number">1</span>][<span class="string">'accum_rate'</span>]</span><br><span class="line">    <span class="keyword">return</span> accum_rate</span><br><span class="line"></span><br><span class="line">value = get_accum_rate_each_day(gid, cookie)</span><br></pre></td></tr></table></figure>

<h3 id="补充阅读"><a href="#补充阅读" class="headerlink" title="补充阅读"></a>补充阅读</h3><p>windows 定时脚本设置<br><a href="https://www.cnblogs.com/sui776265233/p/13602893.html" target="_blank" rel="noopener">https://www.cnblogs.com/sui776265233/p/13602893.html</a><br>linux 定时脚本设置<br><a href="https://www.jianshu.com/p/d93e2b177814" target="_blank" rel="noopener">https://www.jianshu.com/p/d93e2b177814</a></p>

          
        
      
    </div>
    
    
    

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://nonewood.github.io/2022/01/11/xueqiu-performancev1/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="Nonewood">
      <meta itemprop="description" content>
      <meta itemprop="image" content="/images/avatar.gif">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="朝简单处想 往认真处行">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2022/01/11/xueqiu-performancev1/" itemprop="url">雪球模拟组合查询和交易脚本-python</a></h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              
              <time title="创建于" itemprop="dateCreated datePublished" datetime="2022-01-11T08:21:59+08:00">
                2022-01-11
              </time>
            

            

            
          </span>

          

          
            
          

          
          

          

          
            <div class="post-wordcount">
              
                
                <span class="post-meta-item-icon">
                  <i class="fa fa-file-word-o"></i>
                </span>
                
                  <span class="post-meta-item-text">字数统计&#58;</span>
                
                <span title="字数统计">
                  422 字
                </span>
              

              
                <span class="post-meta-divider">|</span>
              

              
                <span class="post-meta-item-icon">
                  <i class="fa fa-clock-o"></i>
                </span>
                
                  <span class="post-meta-item-text">阅读时长 &asymp;</span>
                
                <span title="阅读时长">
                  2 分钟
                </span>
              
            </div>
          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <h2 id="Talk-cheap-show-code"><a href="#Talk-cheap-show-code" class="headerlink" title="Talk cheap, show code"></a>Talk cheap, show code</h2><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> requests</span><br><span class="line"><span class="keyword">import</span> json</span><br><span class="line"></span><br><span class="line"><span class="comment"># 使用前需要替换 cookie 和 组合 id, 怎么找见下边截图/链接</span></span><br><span class="line">cookie = your_cookies</span><br><span class="line">group_id = yout_group_id</span><br><span class="line"></span><br><span class="line"><span class="comment"># 持仓查询函数</span></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">hold_stock</span><span class="params">()</span>:</span></span><br><span class="line">    headers = &#123;</span><br><span class="line">        ‘authority’: ‘tc.xueqiu.com’,</span><br><span class="line">        ‘sec-ch-ua’: ‘” Not A;Brand”;v=“<span class="number">99</span>”, “Chromium”;v=“<span class="number">96</span>”, “Google Chrome”;v=“<span class="number">96</span>”’,</span><br><span class="line">        ‘accept’: ‘application/json, text/plain, */*’,</span><br><span class="line">    <span class="comment">#    ‘accept’: ‘application/json, charset=UTF-8’,</span></span><br><span class="line">        ‘sec-ch-ua-mobile’: ‘?0’,</span><br><span class="line">        ‘user-agent’: ‘Mozilla/<span class="number">5.0</span> (Windows NT <span class="number">6.1</span>; Win64; x64) AppleWebKit/<span class="number">537.36</span> (KHTML, like Gecko) Chrome/<span class="number">96.0</span><span class="number">.4664</span><span class="number">.45</span> Safari/<span class="number">537.36</span>’,</span><br><span class="line">        ‘sec-ch-ua-platform’: ‘”Windows”’,</span><br><span class="line">        ‘origin’: ‘https://xueqiu.com’,</span><br><span class="line">        ‘sec-fetch-site’: ‘same-site’,</span><br><span class="line">        ‘sec-fetch-mode’: ‘cors’,</span><br><span class="line">        ‘sec-fetch-dest’: ‘empty’,</span><br><span class="line">        ‘referer’: ‘https://xueqiu.com/performance’,</span><br><span class="line">        ‘accept-language’: ‘zh-CN,zh;q=<span class="number">0.9</span>,en;q=<span class="number">0.8</span>,zh-TW;q=<span class="number">0.7</span>’,</span><br><span class="line">        ‘cookie’: cookie,</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    params = (</span><br><span class="line">        (‘gid’, group_id),</span><br><span class="line">    )</span><br><span class="line">    response = requests.get(‘https://tc.xueqiu.com/tc/snowx//MONI/performances.json’, headers=headers, params=params)</span><br><span class="line">    response.encoding = “utf<span class="number">-8</span>”</span><br><span class="line">    content = json.loads(response.text)</span><br><span class="line">    res_stock = content[‘result_data’][‘performances’][<span class="number">1</span>][‘list’]</span><br><span class="line">    res_asset = content[‘result_data’][‘performances’][<span class="number">1</span>][‘assets’]</span><br><span class="line">    <span class="keyword">return</span> res_asset, res_stock</span><br><span class="line"></span><br><span class="line"><span class="comment"># 交易函数</span></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">trade</span><span class="params">(direction, date, comment, stock_code, price, shares, tax_rate)</span>:</span></span><br><span class="line">    headers = &#123;</span><br><span class="line">        ‘authority’: ‘tc.xueqiu.com’,</span><br><span class="line">        ‘sec-ch-ua’: ‘” Not A;Brand”;v=“<span class="number">99</span>”, “Chromium”;v=“<span class="number">96</span>”, “Google Chrome”;v=“<span class="number">96</span>”’,</span><br><span class="line">        ‘accept’: ‘application/json, text/plain, */*’,</span><br><span class="line">        ‘content-type’: ‘application/x-www-form-urlencoded’,</span><br><span class="line">        ‘sec-ch-ua-mobile’: ‘?0’,</span><br><span class="line">        ‘user-agent’: ‘Mozilla/<span class="number">5.0</span> (Windows NT <span class="number">6.1</span>; Win64; x64) AppleWebKit/<span class="number">537.36</span> (KHTML, like Gecko) Chrome/<span class="number">96.0</span><span class="number">.4664</span><span class="number">.45</span> Safari/<span class="number">537.36</span>’,</span><br><span class="line">        ‘sec-ch-ua-platform’: ‘”Windows”’,</span><br><span class="line">        ‘origin’: ‘https://xueqiu.com’,</span><br><span class="line">        ‘sec-fetch-site’: ‘same-site’,</span><br><span class="line">        ‘sec-fetch-mode’: ‘cors’,</span><br><span class="line">        ‘sec-fetch-dest’: ‘empty’,</span><br><span class="line">        ‘referer’: ‘https://xueqiu.com/performance’,</span><br><span class="line">        ‘accept-language’: ‘zh-CN,zh;q=<span class="number">0.9</span>,en;q=<span class="number">0.8</span>,zh-TW;q=<span class="number">0.7</span>’,</span><br><span class="line">        ‘cookie’: cookie,</span><br><span class="line">    &#125;</span><br><span class="line">    data = &#123;</span><br><span class="line">      ‘type’: direction, <span class="comment"># 1 是买 2 是卖</span></span><br><span class="line">      ‘date’: date,</span><br><span class="line">      ‘comment’: comment, <span class="comment"># 备注</span></span><br><span class="line">      ‘gid’: group_id,</span><br><span class="line">      ‘symbol’: stock_code,</span><br><span class="line">      ‘price’: price,</span><br><span class="line">      ‘shares’: shares,</span><br><span class="line">      ‘tax_rate’: tax_rate, <span class="comment"># 卖是千一, 买是 0</span></span><br><span class="line">      ‘commission_rate’: ‘<span class="number">0.1</span>’, <span class="comment"># 买卖都是万一</span></span><br><span class="line"></span><br><span class="line">    &#125;</span><br><span class="line">    response = requests.post(‘https://tc.xueqiu.com/tc/snowx/MONI/transaction/add.json’, headers=headers, data=data)</span><br></pre></td></tr></table></figure>

<h2 id="写在后边"><a href="#写在后边" class="headerlink" title="写在后边"></a>写在后边</h2><p>时间少，要做的事情有很多，希望能靠谱，做事，就不废话了…</p>
<h2 id="公众号链接（贴图）"><a href="#公众号链接（贴图）" class="headerlink" title="公众号链接（贴图）"></a>公众号链接（贴图）</h2><p><a href="https://mp.weixin.qq.com/s?__biz=MzI0NTY3MjY0OA==&mid=2247483943&idx=1&sn=f0095ba9f133f9805bfcffe3b97f61c9&chksm=e94bbd80de3c3496948fe638bc832f0ff359a281362b47c23e26320f46a47ea2e951459fe7ea&token=2018691164&lang=zh_CN#rd" target="_blank" rel="noopener">雪球模拟组合查询和交易脚本-python</a></p>

          
        
      
    </div>
    
    
    

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://nonewood.github.io/2021/12/15/xueqiu-performance/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="Nonewood">
      <meta itemprop="description" content>
      <meta itemprop="image" content="/images/avatar.gif">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="朝简单处想 往认真处行">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2021/12/15/xueqiu-performance/" itemprop="url">雪球模拟盘脚本化调仓</a></h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              
              <time title="创建于" itemprop="dateCreated datePublished" datetime="2021-12-15T21:38:26+08:00">
                2021-12-15
              </time>
            

            

            
          </span>

          

          
            
          

          
          

          

          
            <div class="post-wordcount">
              
                
                <span class="post-meta-item-icon">
                  <i class="fa fa-file-word-o"></i>
                </span>
                
                  <span class="post-meta-item-text">字数统计&#58;</span>
                
                <span title="字数统计">
                  540 字
                </span>
              

              
                <span class="post-meta-divider">|</span>
              

              
                <span class="post-meta-item-icon">
                  <i class="fa fa-clock-o"></i>
                </span>
                
                  <span class="post-meta-item-text">阅读时长 &asymp;</span>
                
                <span title="阅读时长">
                  2 分钟
                </span>
              
            </div>
          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <h3 id="为啥干这个？"><a href="#为啥干这个？" class="headerlink" title="为啥干这个？"></a>为啥干这个？</h3><p>工作和个人需要，基于雪球模拟组合实现自动化的股票调仓，主要分几步：<br>1）登录雪球，创建模拟组合，手动添加股票，获取填写的 cURL；<br>2) 转化为 python 的 post  请求；<br>3）运行程序，检查结果即可；</p>
<h3 id="咋干？"><a href="#咋干？" class="headerlink" title="咋干？"></a>咋干？</h3><p>1）创建组合<br>图见公众号链接，下同<br>2）手动添加股票<br>3）开发者工具，找到添加股票的请求<br>4）获取 cURL</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line">curl 'https://tc.xueqiu.com/tc/snowx/MONI/transaction/add.json' \</span><br><span class="line">  -H 'authority: tc.xueqiu.com' \</span><br><span class="line">  -H 'sec-ch-ua: " Not A;Brand";v="99", "Chromium";v="96", "Google Chrome";v="96"' \</span><br><span class="line">  -H 'accept: application/json, text/plain, */*' \</span><br><span class="line">  -H 'content-type: application/x-www-form-urlencoded' \</span><br><span class="line">  -H 'sec-ch-ua-mobile: ?0' \</span><br><span class="line">  -H 'user-agent: Mozilla/5.0 (Macintosh; Intel Mac OS X 10_15_7) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/96.0.4664.110 Safari/537.36' \</span><br><span class="line">  -H 'sec-ch-ua-platform: "macOS"' \</span><br><span class="line">  -H 'origin: https://xueqiu.com' \</span><br><span class="line">  -H 'sec-fetch-site: same-site' \</span><br><span class="line">  -H 'sec-fetch-mode: cors' \</span><br><span class="line">  -H 'sec-fetch-dest: empty' \</span><br><span class="line">  -H 'referer: https://xueqiu.com/performance' \</span><br><span class="line">  -H 'accept-language: zh-CN,zh;q=0.9,en;q=0.8,ja;q=0.7,zh-TW;q=0.6' \</span><br><span class="line">  -H 'cookie: your cookie here' \</span><br><span class="line">  --data-raw 'type=1&amp;date=2021-12-15&amp;gid=4383054580870984&amp;symbol=SZ002157&amp;price=9.49&amp;shares=100&amp;commission_rate=0.1' \</span><br><span class="line">  --compressed</span><br></pre></td></tr></table></figure>

<p>5）转化python的格式<br><a href="https://tool.lu/curl/" target="_blank" rel="noopener">https://tool.lu/curl/</a></p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> requests</span><br><span class="line">headers = &#123;</span><br><span class="line">    <span class="string">'authority'</span>: <span class="string">'tc.xueqiu.com'</span>,</span><br><span class="line">    <span class="string">'sec-ch-ua'</span>: <span class="string">'" Not A;Brand";v="99", "Chromium";v="96", "Google Chrome";v="96"'</span>,</span><br><span class="line">    <span class="string">'accept'</span>: <span class="string">'application/json, text/plain, */*'</span>,</span><br><span class="line">    <span class="string">'content-type'</span>: <span class="string">'application/x-www-form-urlencoded'</span>,</span><br><span class="line">    <span class="string">'sec-ch-ua-mobile'</span>: <span class="string">'?0'</span>,</span><br><span class="line">    <span class="string">'user-agent'</span>: <span class="string">'Mozilla/5.0 (Macintosh; Intel Mac OS X 10_15_7) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/96.0.4664.110 Safari/537.36'</span>,</span><br><span class="line">    <span class="string">'sec-ch-ua-platform'</span>: <span class="string">'"macOS"'</span>,</span><br><span class="line">    <span class="string">'origin'</span>: <span class="string">'https://xueqiu.com'</span>,</span><br><span class="line">    <span class="string">'sec-fetch-site'</span>: <span class="string">'same-site'</span>,</span><br><span class="line">    <span class="string">'sec-fetch-mode'</span>: <span class="string">'cors'</span>,</span><br><span class="line">    <span class="string">'sec-fetch-dest'</span>: <span class="string">'empty'</span>,</span><br><span class="line">    <span class="string">'referer'</span>: <span class="string">'https://xueqiu.com/performance'</span>,</span><br><span class="line">    <span class="string">'accept-language'</span>: <span class="string">'zh-CN,zh;q=0.9,en;q=0.8,ja;q=0.7,zh-TW;q=0.6'</span>,</span><br><span class="line">    <span class="string">'cookie'</span>: <span class="string">'your cookie here'</span>,</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">data = &#123;</span><br><span class="line">  <span class="string">'type'</span>: <span class="string">'1'</span>, <span class="comment"># 1是买，2是卖</span></span><br><span class="line">  <span class="string">'date'</span>: <span class="string">'2021-12-15'</span>,</span><br><span class="line">  <span class="string">'gid'</span>: <span class="string">'4383054580870984'</span>,</span><br><span class="line">  <span class="string">'symbol'</span>: <span class="string">'SZ002714'</span>,</span><br><span class="line">  <span class="string">'price'</span>: <span class="string">'9.49'</span>,</span><br><span class="line">  <span class="string">'shares'</span>: <span class="string">'100'</span>,</span><br><span class="line">  <span class="string">'tax_rate'</span>: <span class="string">'0'</span>,</span><br><span class="line">  <span class="string">'commission_rate'</span>: <span class="string">'0.1'</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">response = requests.post(<span class="string">'https://tc.xueqiu.com/tc/snowx/MONI/transaction/add.json'</span>, headers=headers, data=data)</span><br></pre></td></tr></table></figure>

<p>批量处理的时候，只需要脚本处理 data 的字典内容即可，太简单了，不展开说；</p>
<h3 id="注意的点"><a href="#注意的点" class="headerlink" title="注意的点"></a>注意的点</h3><p>1）cookies 一段时间可能失效，需要手动更新下；<br>2）基金，etf 都可以；</p>
<h3 id="吃水不忘挖井人"><a href="#吃水不忘挖井人" class="headerlink" title="吃水不忘挖井人"></a>吃水不忘挖井人</h3><p><a href="https://github.com/yyri/stockScripts" target="_blank" rel="noopener">https://github.com/yyri/stockScripts</a></p>
<h3 id="公众号链接"><a href="#公众号链接" class="headerlink" title="公众号链接"></a>公众号链接</h3><p><a href="https://mp.weixin.qq.com/s/rIYEBCV04xL1XMky57EtPA" target="_blank" rel="noopener">https://mp.weixin.qq.com/s/rIYEBCV04xL1XMky57EtPA</a></p>

          
        
      
    </div>
    
    
    

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://nonewood.github.io/2021/11/18/search-file-and-zip/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="Nonewood">
      <meta itemprop="description" content>
      <meta itemprop="image" content="/images/avatar.gif">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="朝简单处想 往认真处行">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2021/11/18/search-file-and-zip/" itemprop="url">shell 和 windows 查找文件并且压缩</a></h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              
              <time title="创建于" itemprop="dateCreated datePublished" datetime="2021-11-18T23:11:51+08:00">
                2021-11-18
              </time>
            

            

            
          </span>

          

          
            
          

          
          

          

          
            <div class="post-wordcount">
              
                
                <span class="post-meta-item-icon">
                  <i class="fa fa-file-word-o"></i>
                </span>
                
                  <span class="post-meta-item-text">字数统计&#58;</span>
                
                <span title="字数统计">
                  87 字
                </span>
              

              
                <span class="post-meta-divider">|</span>
              

              
                <span class="post-meta-item-icon">
                  <i class="fa fa-clock-o"></i>
                </span>
                
                  <span class="post-meta-item-text">阅读时长 &asymp;</span>
                
                <span title="阅读时长">
                  1 分钟
                </span>
              
            </div>
          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <p>How to search files and zip（Linux or Windows）</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">find ./  -name '*.tar.zf' -exec zip filname.zip &#123;&#125; +</span><br></pre></td></tr></table></figure>

<figure class="highlight powershell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line"><span class="built_in">Get-ChildItem</span> -Path D:\test -Recurse -Include *.tar.gz| <span class="built_in">Compress-Archive</span> -Verbose -DestinationPath D:\test.zip -Force </span><br><span class="line"></span><br><span class="line"><span class="variable">$filepath</span>=<span class="string">"D:\test"</span> </span><br><span class="line"><span class="variable">$zippath</span>=<span class="string">"D:\test.zip"</span> </span><br><span class="line"><span class="built_in">Get-ChildItem</span> -Path <span class="variable">$filepath</span> -Recurse -Include *.tar.gz| <span class="built_in">Compress-Archive</span> -Verbose -DestinationPath <span class="variable">$zippath</span> -Force</span><br></pre></td></tr></table></figure>

<h3 id="参考链接"><a href="#参考链接" class="headerlink" title="参考链接"></a>参考链接</h3><p><a href="https://www.twblogs.net/a/5b7d44a32b71770a43de7828" target="_blank" rel="noopener">https://www.twblogs.net/a/5b7d44a32b71770a43de7828</a><br><a href="https://www.codegrepper.com/code-examples/shell/powershell+zip+multiple+files" target="_blank" rel="noopener">https://www.codegrepper.com/code-examples/shell/powershell+zip+multiple+files</a><br><a href="https://community.spiceworks.com/topic/2239060-search-for-files-and-zip" target="_blank" rel="noopener">https://community.spiceworks.com/topic/2239060-search-for-files-and-zip</a></p>

          
        
      
    </div>
    
    
    

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://nonewood.github.io/2021/11/07/513050-backtest/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="Nonewood">
      <meta itemprop="description" content>
      <meta itemprop="image" content="/images/avatar.gif">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="朝简单处想 往认真处行">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2021/11/07/513050-backtest/" itemprop="url">基于另类数据对ETF进行回测</a></h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              
              <time title="创建于" itemprop="dateCreated datePublished" datetime="2021-11-07T17:38:10+08:00">
                2021-11-07
              </time>
            

            

            
          </span>

          

          
            
          

          
          

          

          
            <div class="post-wordcount">
              
                
                <span class="post-meta-item-icon">
                  <i class="fa fa-file-word-o"></i>
                </span>
                
                  <span class="post-meta-item-text">字数统计&#58;</span>
                
                <span title="字数统计">
                  2.2k 字
                </span>
              

              
                <span class="post-meta-divider">|</span>
              

              
                <span class="post-meta-item-icon">
                  <i class="fa fa-clock-o"></i>
                </span>
                
                  <span class="post-meta-item-text">阅读时长 &asymp;</span>
                
                <span title="阅读时长">
                  9 分钟
                </span>
              
            </div>
          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <h2 id="基本背景"><a href="#基本背景" class="headerlink" title="基本背景"></a>基本背景</h2><p><a href="https://mp.weixin.qq.com/s/RFJM06EFiuBezAWLmfQMdg" target="_blank" rel="noopener">彭博盘前简报：7月14日</a></p>
<p>每天都会看这个公众号，而且会在盘前发，发现内容中提到的中概股和中概ETF的涨跌具有一定的相关性，早就手痒痒了想做一下回测看是否真得如此，于是，花了一整天时间… 有了这篇文章。</p>
<h2 id="爬取公众号文章"><a href="#爬取公众号文章" class="headerlink" title="爬取公众号文章"></a>爬取公众号文章</h2><p>爬取过程中三个麻烦的点：<br>1）可能会输入验证码；<br>2）爬取几次后，cookies会失效；<br>3）到最后即使手动查询想要查询的公众号，也会报错，返回了None（不知道是不是爬取次数过多的原因），不过弄到的数据已经够我用了（再早，这个公众号还没有中概股这个版块）；</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br><span class="line">166</span><br><span class="line">167</span><br><span class="line">168</span><br><span class="line">169</span><br><span class="line">170</span><br><span class="line">171</span><br><span class="line">172</span><br><span class="line">173</span><br><span class="line">174</span><br><span class="line">175</span><br><span class="line">176</span><br><span class="line">177</span><br><span class="line">178</span><br><span class="line">179</span><br><span class="line">180</span><br><span class="line">181</span><br><span class="line">182</span><br><span class="line">183</span><br><span class="line">184</span><br><span class="line">185</span><br><span class="line">186</span><br><span class="line">187</span><br><span class="line">188</span><br><span class="line">189</span><br><span class="line">190</span><br><span class="line">191</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> os,re</span><br><span class="line"> </span><br><span class="line"><span class="keyword">from</span> selenium <span class="keyword">import</span> webdriver <span class="comment">#引入自动化登录模块</span></span><br><span class="line"><span class="keyword">import</span> time,datetime <span class="comment">#时间模块</span></span><br><span class="line"><span class="keyword">import</span> json</span><br><span class="line"><span class="keyword">import</span> requests <span class="comment">#抓取信息</span></span><br><span class="line"><span class="keyword">import</span> random</span><br><span class="line"><span class="keyword">from</span> selenium.webdriver.common.by <span class="keyword">import</span> By <span class="comment">#引入定位寻找模块</span></span><br><span class="line"><span class="keyword">from</span> selenium.webdriver.common.keys <span class="keyword">import</span> Keys <span class="comment">#引入键盘动作模块</span></span><br><span class="line"><span class="keyword">from</span> selenium.webdriver <span class="keyword">import</span> ActionChains <span class="comment">#引入鼠标行为模块</span></span><br><span class="line"> </span><br><span class="line"> </span><br><span class="line"><span class="comment"># 微信公众号账号</span></span><br><span class="line">user=<span class="string">""</span></span><br><span class="line"><span class="comment">#公众号密码</span></span><br><span class="line">password=<span class="string">""</span></span><br><span class="line"><span class="comment">#设置要爬取的公众号列表</span></span><br><span class="line">gzlist=[<span class="string">'彭博环球财经'</span>]</span><br><span class="line"><span class="comment">#保存的结果文件地址</span></span><br><span class="line">fileName=<span class="string">"articles.xls"</span></span><br><span class="line"></span><br><span class="line"><span class="comment">#登录微信公众号，获取登录之后的cookies信息，并保存到本地文本中</span></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">weChat_login</span><span class="params">()</span>:</span></span><br><span class="line">    <span class="comment">#定义一个空的字典，存放cookies内容</span></span><br><span class="line">    post=&#123;&#125;</span><br><span class="line"> </span><br><span class="line">    <span class="comment">#用webdriver启动谷歌浏览器</span></span><br><span class="line">    print(<span class="string">"启动浏览器，打开微信公众号登录界面"</span>)</span><br><span class="line">    <span class="comment">#CHROME_DRIVER=r"F:\\chromedriver.exe"</span></span><br><span class="line">    op = webdriver.ChromeOptions()</span><br><span class="line">    <span class="comment"># macos 使用的语句</span></span><br><span class="line">    driver = webdriver.Chrome(options=op)</span><br><span class="line">    <span class="comment">#driver = webdriver.Chrome(executable_path=CHROME_DRIVER)</span></span><br><span class="line">    <span class="comment">#driver.set_window_position(0,0)</span></span><br><span class="line">    <span class="comment">#driver.maximize_window()</span></span><br><span class="line">    <span class="comment">#打开微信公众号登录页面</span></span><br><span class="line">    driver.get(<span class="string">'https://mp.weixin.qq.com/'</span>)</span><br><span class="line">    <span class="comment">#等待5秒钟</span></span><br><span class="line">    time.sleep(<span class="number">10</span>)</span><br><span class="line">    print(<span class="string">"正在输入微信公众号登录账号和密码......"</span>)</span><br><span class="line">    driver.find_element_by_xpath(<span class="string">"./*//a[@class='login__type__container__select-type']"</span>).click() <span class="comment">#鼠标放到使用账号密码登录键上</span></span><br><span class="line">     </span><br><span class="line">    <span class="comment">#清空账号框中的内容</span></span><br><span class="line">    driver.find_element_by_xpath(<span class="string">'//*[@id="header"]/div[2]/div/div/div[1]/form/div[1]/div[1]/div/span/input'</span>).clear()</span><br><span class="line">    <span class="comment">#自动填入登录用户名</span></span><br><span class="line">    driver.find_element_by_xpath(<span class="string">'//*[@id="header"]/div[2]/div/div/div[1]/form/div[1]/div[1]/div/span/input'</span>).send_keys(user)</span><br><span class="line">    <span class="comment">#清空密码框中的内容</span></span><br><span class="line">    driver.find_element_by_xpath(<span class="string">'//*[@id="header"]/div[2]/div/div/div[1]/form/div[1]/div[2]/div/span/input'</span>).clear()</span><br><span class="line">    <span class="comment">#自动填入登录密码</span></span><br><span class="line">    driver.find_element_by_xpath(<span class="string">'//*[@id="header"]/div[2]/div/div/div[1]/form/div[1]/div[2]/div/span/input'</span>).send_keys(password)</span><br><span class="line"> </span><br><span class="line">     </span><br><span class="line">    <span class="comment">#自动点击登录按钮进行登录</span></span><br><span class="line">    driver.find_element_by_xpath(<span class="string">'//*[@id="header"]/div[2]/div/div/div[1]/form/div[4]/a'</span>).click()</span><br><span class="line">    <span class="comment"># 拿手机扫二维码！</span></span><br><span class="line">    print(<span class="string">"请拿手机扫码二维码登录公众号"</span>)</span><br><span class="line">    time.sleep(<span class="number">20</span>)</span><br><span class="line">    print(<span class="string">"登录成功"</span>)</span><br><span class="line">    <span class="comment">#重新载入公众号登录页，登录之后会显示公众号后台首页，从这个返回内容中获取cookies信息</span></span><br><span class="line">    driver.get(<span class="string">'https://mp.weixin.qq.com/'</span>)</span><br><span class="line">    <span class="comment">#获取cookies</span></span><br><span class="line">    cookie_items = driver.get_cookies()</span><br><span class="line"> </span><br><span class="line">    <span class="comment">#获取到的cookies是列表形式，将cookies转成json形式并存入本地名为cookie的文本中</span></span><br><span class="line">    <span class="keyword">for</span> cookie_item <span class="keyword">in</span> cookie_items:</span><br><span class="line">        post[cookie_item[<span class="string">'name'</span>]] = cookie_item[<span class="string">'value'</span>]</span><br><span class="line">    cookie_str = json.dumps(post)</span><br><span class="line">    <span class="keyword">with</span> open(<span class="string">'cookie.txt'</span>, <span class="string">'w+'</span>, encoding=<span class="string">'utf-8'</span>) <span class="keyword">as</span> f:</span><br><span class="line">        f.write(cookie_str)</span><br><span class="line">    print(<span class="string">"cookies信息已保存到本地"</span>)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">get_content</span><span class="params">(query)</span>:</span></span><br><span class="line">    <span class="comment">#query为要爬取的公众号名称</span></span><br><span class="line">    <span class="comment">#公众号主页</span></span><br><span class="line">    url = <span class="string">'https://mp.weixin.qq.com/'</span></span><br><span class="line">    <span class="comment">#设置headers</span></span><br><span class="line">    header = &#123;</span><br><span class="line">        <span class="string">"HOST"</span>: <span class="string">"mp.weixin.qq.com"</span>,</span><br><span class="line">        <span class="string">"User-Agent"</span>: <span class="string">"Mozilla/5.0 (Windows NT 6.1; WOW64; rv:53.0) Gecko/20100101 Firefox/53.0"</span></span><br><span class="line">        &#125;</span><br><span class="line"> </span><br><span class="line">    <span class="comment">#读取上一步获取到的cookies</span></span><br><span class="line">    <span class="keyword">with</span> open(<span class="string">'cookie.txt'</span>, <span class="string">'r'</span>, encoding=<span class="string">'utf-8'</span>) <span class="keyword">as</span> f:</span><br><span class="line">        cookie = f.read()</span><br><span class="line">    cookies = json.loads(cookie)</span><br><span class="line"> </span><br><span class="line">    <span class="comment">#登录之后的微信公众号首页url变化为：https://mp.weixin.qq.com/cgi-bin/home?t=home/index&amp;lang=zh_CN&amp;token=1849751598，从这里获取token信息</span></span><br><span class="line">    response = requests.get(url=url, cookies=cookies)</span><br><span class="line">    token = re.findall(<span class="string">r'token=(\d+)'</span>, str(response.url))[<span class="number">0</span>]</span><br><span class="line"> </span><br><span class="line">    <span class="comment">#搜索微信公众号的接口地址</span></span><br><span class="line">    search_url = <span class="string">'https://mp.weixin.qq.com/cgi-bin/searchbiz?'</span></span><br><span class="line">    <span class="comment">#搜索微信公众号接口需要传入的参数，有三个变量：微信公众号token、随机数random、搜索的微信公众号名字</span></span><br><span class="line">    query_id = &#123;</span><br><span class="line">        <span class="string">'action'</span>: <span class="string">'search_biz'</span>,</span><br><span class="line">        <span class="string">'token'</span> : token,</span><br><span class="line">        <span class="string">'lang'</span>: <span class="string">'zh_CN'</span>,</span><br><span class="line">        <span class="string">'f'</span>: <span class="string">'json'</span>,</span><br><span class="line">        <span class="string">'ajax'</span>: <span class="string">'1'</span>,</span><br><span class="line">        <span class="string">'random'</span>: random.random(),</span><br><span class="line">        <span class="string">'query'</span>: query,</span><br><span class="line">        <span class="string">'begin'</span>: <span class="string">'0'</span>,</span><br><span class="line">        <span class="string">'count'</span>: <span class="string">'5'</span></span><br><span class="line">        &#125; </span><br><span class="line">    <span class="comment">#打开搜索微信公众号接口地址，需要传入相关参数信息如：cookies、params、headers</span></span><br><span class="line">    search_response = requests.get(search_url, cookies=cookies, headers=header, params=query_id)</span><br><span class="line">    <span class="comment">#print(search_response)</span></span><br><span class="line">    <span class="comment">#取搜索结果中的第一个公众号</span></span><br><span class="line">    lists = search_response.json().get(<span class="string">'list'</span>)[<span class="number">0</span>]</span><br><span class="line">    print(lists)</span><br><span class="line">    <span class="comment">#获取这个公众号的fakeid，后面爬取公众号文章需要此字段</span></span><br><span class="line">    fakeid = lists.get(<span class="string">'fakeid'</span>)</span><br><span class="line"> </span><br><span class="line">    <span class="comment">#微信公众号文章接口地址</span></span><br><span class="line">    appmsg_url = <span class="string">'https://mp.weixin.qq.com/cgi-bin/appmsg?'</span></span><br><span class="line">    <span class="comment">#搜索文章需要传入几个参数：登录的公众号token、要爬取文章的公众号fakeid、随机数random</span></span><br><span class="line">    query_id_data = &#123;</span><br><span class="line">        <span class="string">'token'</span>: token,</span><br><span class="line">        <span class="string">'lang'</span>: <span class="string">'zh_CN'</span>,</span><br><span class="line">        <span class="string">'f'</span>: <span class="string">'json'</span>,</span><br><span class="line">        <span class="string">'ajax'</span>: <span class="string">'1'</span>,</span><br><span class="line">        <span class="string">'random'</span>: random.random(),</span><br><span class="line">        <span class="string">'action'</span>: <span class="string">'list_ex'</span>,</span><br><span class="line">        <span class="string">'begin'</span>: <span class="string">'0'</span>,<span class="comment">#不同页，此参数变化，变化规则为每页加5</span></span><br><span class="line">        <span class="string">'count'</span>: <span class="string">'5'</span>,</span><br><span class="line">        <span class="string">'query'</span>: <span class="string">''</span>,</span><br><span class="line">        <span class="string">'fakeid'</span>: fakeid,</span><br><span class="line">        <span class="string">'type'</span>: <span class="string">'9'</span></span><br><span class="line">        &#125;</span><br><span class="line">    <span class="comment">#打开搜索的微信公众号文章列表页</span></span><br><span class="line">    appmsg_response = requests.get(appmsg_url, cookies=cookies, headers=header, params=query_id_data)</span><br><span class="line">    print(appmsg_response.json())</span><br><span class="line">    <span class="comment">#获取文章总数</span></span><br><span class="line">    max_num = appmsg_response.json().get(<span class="string">'app_msg_cnt'</span>)</span><br><span class="line">    print(max_num)</span><br><span class="line">    <span class="comment">#print(max_num)</span></span><br><span class="line">    <span class="comment">#每页至少有5条，获取文章总的页数，爬取时需要分页爬</span></span><br><span class="line">    num = int(int(max_num) / <span class="number">5</span>)</span><br><span class="line">    <span class="comment">#print(num)</span></span><br><span class="line">    <span class="comment">#起始页begin参数，往后每页加5</span></span><br><span class="line">    begin = <span class="number">0</span></span><br><span class="line">    <span class="keyword">while</span> num + <span class="number">1</span> &gt; <span class="number">0</span> :</span><br><span class="line">        query_id_data = &#123;</span><br><span class="line">            <span class="string">'token'</span>: token,</span><br><span class="line">            <span class="string">'lang'</span>: <span class="string">'zh_CN'</span>,</span><br><span class="line">            <span class="string">'f'</span>: <span class="string">'json'</span>,</span><br><span class="line">            <span class="string">'ajax'</span>: <span class="string">'1'</span>,</span><br><span class="line">            <span class="string">'random'</span>: random.random(),</span><br><span class="line">            <span class="string">'action'</span>: <span class="string">'list_ex'</span>,</span><br><span class="line">            <span class="string">'begin'</span>: <span class="string">'&#123;&#125;'</span>.format(str(begin)),</span><br><span class="line">            <span class="string">'count'</span>: <span class="string">'5'</span>,</span><br><span class="line">            <span class="string">'query'</span>: <span class="string">''</span>,</span><br><span class="line">            <span class="string">'fakeid'</span>: fakeid,</span><br><span class="line">            <span class="string">'type'</span>: <span class="string">'9'</span></span><br><span class="line">            &#125;</span><br><span class="line">        print(<span class="string">'正在翻页：--------------'</span>,begin)</span><br><span class="line"> </span><br><span class="line">        <span class="comment">#获取每一页文章的标题和链接地址，并写入本地文本中</span></span><br><span class="line">        query_fakeid_response = requests.get(appmsg_url, cookies=cookies, headers=header, params=query_id_data)</span><br><span class="line">        print(query_fakeid_response)</span><br><span class="line">        fakeid_list = query_fakeid_response.json().get(<span class="string">'app_msg_list'</span>)</span><br><span class="line">        <span class="comment">#print(fakeid_list)</span></span><br><span class="line">        <span class="keyword">for</span> item <span class="keyword">in</span> fakeid_list:</span><br><span class="line">            content_link=item.get(<span class="string">'link'</span>) <span class="comment">#链接</span></span><br><span class="line">            content_title=item.get(<span class="string">'title'</span>) <span class="comment">#题目</span></span><br><span class="line">			   <span class="comment"># 我只需要盘前简报</span></span><br><span class="line">            <span class="keyword">if</span> re.search(<span class="string">'彭博盘前简报'</span>, content_title):</span><br><span class="line">                print(content_title)</span><br><span class="line">                update_time=time.strftime(<span class="string">"%Y-%m-%d %H:%M:%S"</span>, time.localtime(item.get(<span class="string">'update_time'</span>))) <span class="comment">#发布时间</span></span><br><span class="line">                <span class="comment">#print(content_title+"\t"+content_link+"\t""+update_time+"\n"))</span></span><br><span class="line">                <span class="keyword">with</span> open(fileName,<span class="string">'a'</span>,encoding=<span class="string">'utf-8'</span>) <span class="keyword">as</span> fh:</span><br><span class="line">                    fh.write(content_title+<span class="string">"\t"</span>+content_link+<span class="string">"\t"</span>+update_time+<span class="string">"\n"</span>)</span><br><span class="line">        num -= <span class="number">1</span></span><br><span class="line">        begin = int(begin)</span><br><span class="line">        begin+=<span class="number">5</span></span><br><span class="line">        time.sleep(<span class="number">2</span>)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> __name__==<span class="string">'__main__'</span>:</span><br><span class="line">    <span class="keyword">try</span>:</span><br><span class="line">        <span class="comment">#登录微信公众号，获取登录之后的cookies信息，并保存到本地文本中</span></span><br><span class="line">        weChat_login()</span><br><span class="line">        <span class="comment">#登录之后，通过微信公众号后台提供的微信公众号文章接口爬取文章</span></span><br><span class="line">        <span class="keyword">for</span> query <span class="keyword">in</span> gzlist:</span><br><span class="line">            <span class="comment">#爬取微信公众号文章，并存在本地文本中</span></span><br><span class="line">            print(<span class="string">"开始爬取公众号："</span>+query)</span><br><span class="line">            get_content(query)</span><br><span class="line">            print(<span class="string">"爬取完成"</span>)</span><br><span class="line">    <span class="keyword">except</span> Exception <span class="keyword">as</span> e:</span><br><span class="line">        print(str(e))</span><br></pre></td></tr></table></figure>

<h3 id="本部分参考链接"><a href="#本部分参考链接" class="headerlink" title="本部分参考链接"></a>本部分参考链接</h3><p><a href="https://blog.nowcoder.net/n/a1920b33dae144bfb56f17b48ed90e6a" target="_blank" rel="noopener">python爬取公众号历史文章_牛客博客</a><br><a href="https://blog.csdn.net/weixin_39688870/article/details/111645741" target="_blank" rel="noopener">python爬取公众号阅读量_Python爬取微信公众号文章以及在看阅读数_weixin_39688870的博客-CSDN博客</a></p>
<h2 id="处理数据"><a href="#处理数据" class="headerlink" title="处理数据"></a>处理数据</h2><p>需要的文件：<br>1）上文爬到的结果文件；<br>2）中概ETF 513050的行情信息，由通达信导出；</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> pandas <span class="keyword">as</span> pd</span><br><span class="line"><span class="keyword">from</span> bs4 <span class="keyword">import</span> BeautifulSoup</span><br><span class="line"><span class="keyword">import</span> numpy <span class="keyword">as</span> np</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">dt = pd.read_table(<span class="string">'articles.csv'</span>, header = <span class="literal">None</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment"># 按需处理数据</span></span><br><span class="line">dt = dt.drop_duplicates()</span><br><span class="line">dt = dt[[ <span class="literal">True</span> <span class="keyword">if</span> re.search(<span class="string">'彭博盘前简报'</span>, x) <span class="keyword">else</span> <span class="literal">False</span> <span class="keyword">for</span> x <span class="keyword">in</span> dt[<span class="number">0</span>]]]</span><br><span class="line"></span><br><span class="line">df = pd.DataFrame(columns = [<span class="string">'date'</span>, <span class="string">'change'</span>])</span><br><span class="line"><span class="keyword">for</span> index <span class="keyword">in</span> range(<span class="number">0</span>, dt.shape[<span class="number">0</span>]):    </span><br><span class="line">    <span class="comment">#print(dt[1])</span></span><br><span class="line">    url = list(dt[<span class="number">1</span>])[index]</span><br><span class="line">    date = list(dt[<span class="number">2</span>])[index][:<span class="number">10</span>]</span><br><span class="line">    res = requests.get(url)</span><br><span class="line">    soup = BeautifulSoup(res.content, <span class="string">"html.parser"</span>)</span><br><span class="line">    content = soup.get_text()</span><br><span class="line">    <span class="comment">#match = re.search('(中概股：.*)美国债市', content)</span></span><br><span class="line">    <span class="comment"># 这里我只使用了金龙中国指数作为测试</span></span><br><span class="line">    match1 = re.search(<span class="string">'金龙中国指数上涨(\d\.\d?)%'</span>, content)</span><br><span class="line">    match2 = re.search(<span class="string">'金龙中国指数下跌(\d\.\d?)%'</span>, content)</span><br><span class="line">    row = dict()</span><br><span class="line">    change = <span class="number">0</span></span><br><span class="line">    <span class="keyword">if</span> match1:</span><br><span class="line">        change = float(match1.group(<span class="number">1</span>))</span><br><span class="line">        </span><br><span class="line">    <span class="keyword">if</span> match2:</span><br><span class="line">        change = <span class="number">0</span> - float(match2.group(<span class="number">1</span>))</span><br><span class="line">        </span><br><span class="line">    row = &#123;<span class="string">'date'</span>: date, <span class="string">'change'</span>: change&#125;</span><br><span class="line">    df = df.append(row, ignore_index=<span class="literal">True</span>)</span><br><span class="line"></span><br><span class="line">df[<span class="string">'date'</span>] = pd.to_datetime(df[<span class="string">'date'</span>])</span><br><span class="line">df  = df.set_index(<span class="string">'date'</span>)</span><br><span class="line">df = df[df.change != <span class="number">0</span>]</span><br><span class="line">df = df.drop_duplicates()</span><br><span class="line"></span><br><span class="line"><span class="comment"># etf 行情</span></span><br><span class="line">price = pd.read_table(<span class="string">'513050.xls'</span>)</span><br><span class="line">new_column = [x.strip() <span class="keyword">for</span> x <span class="keyword">in</span> price.columns]</span><br><span class="line">price.columns = new_column</span><br><span class="line">price[<span class="string">'date'</span>] = pd.to_datetime(price[<span class="string">'时间'</span>], format=<span class="string">'%Y/%m/%d'</span>)</span><br><span class="line"><span class="comment"># 计算每日开盘买入，收盘价卖出的话，收益率多少</span></span><br><span class="line">price[<span class="string">'etf_change'</span>] = (price[<span class="string">'收盘'</span>] - price[<span class="string">'开盘'</span>])/price[<span class="string">'开盘'</span>]*<span class="number">100</span></span><br><span class="line">price = price[[<span class="string">'date'</span>, <span class="string">'开盘'</span>, <span class="string">'收盘'</span>, <span class="string">'etf_change'</span>]]</span><br><span class="line">price = price.set_index(<span class="string">'date'</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment"># 合并数据，看下信合和场内的etf日涨跌幅是否有关系？</span></span><br><span class="line"><span class="comment"># 这边看效果不太好，可能和有缺失值相关</span></span><br><span class="line">dm = pd.concat([price, df], join = <span class="string">'inner'</span>, axis = <span class="number">1</span>)</span><br><span class="line">fig = plt.figure(figsize = (<span class="number">20</span>,<span class="number">8</span>))</span><br><span class="line">dm.change.plot(color = <span class="string">'blue'</span>,kind = <span class="string">'bar'</span>, alpha = <span class="number">0.2</span>)</span><br><span class="line">dm.etf_change.plot(color = <span class="string">'red'</span>, kind = <span class="string">'bar'</span>, alpha = <span class="number">0.2</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment"># 输出信号文件</span></span><br><span class="line"><span class="comment"># 信号日期往前推一天</span></span><br><span class="line">dm[<span class="string">'date'</span>] = [x - np.timedelta64(<span class="number">1</span>, <span class="string">'D'</span>) <span class="keyword">for</span> x <span class="keyword">in</span> dm.index]</span><br><span class="line">dm = dm.set_index(<span class="string">'date'</span>)</span><br><span class="line">dm[<span class="string">'instrument'</span>] = <span class="string">'510500.HOF'</span></span><br><span class="line">dm.to_csv(<span class="string">'signal.csv'</span>)</span><br></pre></td></tr></table></figure>

<p>涨跌幅是否一致，画了个图，不是很一致…<br>不过，大过年的，来都来了… 就再回测一把吧….</p>
<h2 id="回测平台回测"><a href="#回测平台回测" class="headerlink" title="回测平台回测"></a>回测平台回测</h2><p>使用的平台是bigquant，交易逻辑很简单，还有优化的空间：<br>1）当信号大于1时，买入；<br>2）如果买入后第二天有信号，且信号小于0才卖出，否则不卖出； 如果没有 信号，则直接卖出；</p>
<p>回测有 4.25% 的收益率，跑赢基准 7个点 +.+</p>
<h2 id="总结"><a href="#总结" class="headerlink" title="总结"></a>总结</h2><p>其实我觉得公众号的能源和油气也可以试试，不过观察来看华宝油气一般开盘价就是最高点，不给买入的机会…. 后边再试试；<br>算是对自己观察所得另类数据的一个小尝试吧，有好多东西要学习啊啊啊啊啊啊啊…..</p>

          
        
      
    </div>
    
    
    

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://nonewood.github.io/2021/10/30/diligent/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="Nonewood">
      <meta itemprop="description" content>
      <meta itemprop="image" content="/images/avatar.gif">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="朝简单处想 往认真处行">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2021/10/30/diligent/" itemprop="url">勤劳</a></h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              
              <time title="创建于" itemprop="dateCreated datePublished" datetime="2021-10-30T09:35:13+08:00">
                2021-10-30
              </time>
            

            

            
          </span>

          

          
            
          

          
          

          

          
            <div class="post-wordcount">
              
                
                <span class="post-meta-item-icon">
                  <i class="fa fa-file-word-o"></i>
                </span>
                
                  <span class="post-meta-item-text">字数统计&#58;</span>
                
                <span title="字数统计">
                  1.8k 字
                </span>
              

              
                <span class="post-meta-divider">|</span>
              

              
                <span class="post-meta-item-icon">
                  <i class="fa fa-clock-o"></i>
                </span>
                
                  <span class="post-meta-item-text">阅读时长 &asymp;</span>
                
                <span title="阅读时长">
                  5 分钟
                </span>
              
            </div>
          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <h3 id="写在前边"><a href="#写在前边" class="headerlink" title="写在前边"></a>写在前边</h3><p>觉得自己有些懒了，找些片段记录下，补充一下。<br>这就像饿了，去觅食一样。</p>
<p>之前做数据分析的时候，可视化会用到云图，简单来说就是基于文本内容统计词频，然后频率越高，字号越大，表达一下该词的重要性。</p>
<p>那我想读书也可以，以某一个专题去摘录一些片段，如果能略有收获，那再好不过。</p>
<h3 id="勤"><a href="#勤" class="headerlink" title="勤"></a>勤</h3><p><strong>我一直保持全勤（我从不过什么圣礼拜一￼），所以得到师傅的器重</strong>，再加上我排字麻利得不是一般，于是所有的急活都派给我干，这种活一般来说，拿钱要多一点。<strong>所以这一段日子我过得十分惬意。</strong></p>
<p>等我把版拆开，将铅字在字盘里归好位等第二天用时，已经是夜里十一点了，有时候还要晚：因为别的朋友还会时不时地送来一些零活，我们只好往后拖。<br>但我下定决心每天仍然排印一张对开纸，结果有天夜里，我已经锁定印版，以为一天的工作结束了的时候，不小心把一个印版碰坏了，有两页铅字乱得一塌糊涂，我马上拆版重排，排好了才上床睡觉。<strong>我们这样勤奋苦干，邻居们有目共睹，我们开始赢得了声望和信誉；</strong>我还听说商界的夜夜俱乐部有人提起新开张的印刷所（指的是富兰克林新开的），普遍的看法是必死无疑，因为当地已经有了凯默和布雷福德两家印刷所；然而贝尔德博士（多年以后你我在苏格兰他的故乡圣安德鲁斯见过他）则力排众议；<strong>因为那个富兰克林的勤奋，他说，是他的同行们望尘莫及的：我离开俱乐部回家时，他还在干活呢；他的邻居还没有起床，他又在工作了。</strong></p>
<p>为了确保我作为一个生意人的信誉和人格，我处处留心，不仅要<strong>实打实的勤奋节俭</strong>，而且在面子上也避免有相反的表现。我衣着朴素；从不到娱乐场消闲鬼混；我从不出去钓鱼打猎；的确，看书有时候使我忘乎所以，误了正事；不过这种情况非常罕见，又十分隐蔽，没有引起物议：为了证明我不是个甩手掌柜，有时候我把从商店买来的纸张用手推车推过大街小巷送到家中。<strong>这样一来，人们认为我是个勤奋、发达的青年，买东西按时付款，进口文具的商人拉我做他们的客户，别的商人提议给我供书代销，我的事业顺风顺水。</strong></p>
<p>小时候，父亲对我谆谆教导，所罗门的一句箴言被屡屡重复：<strong>“你看见办事殷勤的人吗？他必站在君王面前，必不站在下贱人面前。”￼</strong>从那时候起，<strong>我就把勤奋看成谋求财富和功名的手段</strong>，这句话给我很大的鼓励：尽管我并不认为我真的要站在君王面前，不过，后来这种事还真的发生了。——<strong>因为我曾在五位君王面前站过，甚至还有幸坐下来跟一位丹麦国王同席共餐。</strong></p>
<p>六，勤奋。<br>珍惜时光。手里总忙有益之事。剪除一切无谓之举。<br>（路过：这里是富兰克林列出来的有必要让自己遵守和养成习惯的十三种美德，勤奋是第六项）</p>
<p><strong>节俭和勤奋，使我摆脱了剩下的债务，获得了独立和富裕，所以使我更容易实施诚信和正义等等。</strong></p>
<p>把长期持续的健康归功于节制，它至今还给他留下一副好身板。<strong>多亏了勤奋和节俭，他早年景况顺遂，获取了财富，还学得了种种知识，使他成为一位有用的公民，为他在学术界赢得了一定的声誉。</strong>他把祖国委任他的光荣职务归功于诚信和正义。这一整套美德，哪怕还处在他能获得的那种不完善的状态下，也多亏了它们的联合影响，使他能够脾气平和，谈笑风生，所以他一直人缘很好，甚至深得年轻朋友的喜欢。￼所以我希望我的某些子孙不妨学习学习，从中获得好处。</p>
<p><strong>怠惰使万事艰难，勤勉使一切便当</strong>，穷理查就是这么说的；<strong>起得晚就得整天奔波，到天黑还赶不完自己的工作</strong>。<strong>懒惰走路慢腾腾，穷困赶上快如风</strong>，我们在穷理查的历书上读到的就是这样。他还说，<strong>必须人逼事，勿让事逼人。</strong>睡得早，起得早，富裕、聪明、身体好。</p>
<p>我想我听到你们有些人说，<strong>难道一个人不可有闲暇吗？ 朋友，我要告诉你穷理查的话：要想得到闲暇，就好好利用时光。既然你对一分钟没有把握，就别丢掉一小时。</strong>闲暇是准备做有益的事情的时光。这种闲暇，勤奋的人会得到，懒汉却永远不会有。所以穷理查说，<strong>闲暇的生活与懒惰的生活是两码事。</strong></p>
<p>认为怠惰比勤奋更能使你舒畅吗？不，因为穷理查说<strong>：懒惰生烦恼，安逸惹酸苦。不劳力的人只靠智谋生活，会因主干不牢而摧折。勤奋给人舒适、富足和尊敬。</strong></p>
<p>以上全部摘录于《富兰克林自传》</p>
<h3 id="写在后边"><a href="#写在后边" class="headerlink" title="写在后边"></a>写在后边</h3><p>我为什么要做这样的摘录，并且把后边把因为勤劳而获得的好处也加粗了呢? 富兰克林是这么说的：</p>
<blockquote>
<p>我之所以这样毫无顾忌地强调自己的勤奋，尽管有自吹自擂之嫌，目的无非是让读过它的子孙后代们看到在这段叙述中勤奋产生的于我有利的效果时，就可以知道这种美德的用处了。</p>
</blockquote>
<p>看了就能记住吗？记住就能做到吗？真得会有效果吗？富兰克林是这么说的：</p>
<blockquote>
<p>然而，总体来讲，<strong>虽然我从来没有达到我曾经雄心勃勃要达到的那种完美境界，而且还相去甚远，但我通过努力成为一个比较优秀、比较快乐的人，若不努力我是做不到这一步的</strong>；就像有些人临摹字帖，一心要练就一笔好字，尽管他们永远达不到他们希望达到的字帖的那种优秀水准，但通过努力书法大有长进，字写得漂亮清晰，也算说得过去了。</p>
</blockquote>
<p>其他人的传记里，也有不少，篇幅原因，记录到这里；</p>
<p>2021年10月30日 @XA</p>

          
        
      
    </div>
    
    
    

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
  </section>

  
  <nav class="pagination">
    <span class="page-number current">1</span><a class="page-number" href="/page/2/">2</a><span class="space">&hellip;</span><a class="page-number" href="/page/9/">9</a><a class="extend next" rel="next" href="/page/2/"><i class="fa fa-angle-right"></i></a>
  </nav>



          </div>
          


          

<script async src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
<!-- 侧边广告 -->
<ins class="adsbygoogle" style="display:block" data-ad-client="ca-pub-7093029654692281" data-ad-slot="4703719462" data-ad-format="auto" data-full-width-responsive="true"></ins>
<script>
     (adsbygoogle = window.adsbygoogle || []).push({});
</script>

        </div>
        
          
  
  <div class="sidebar-toggle">
    <div class="sidebar-toggle-line-wrap">
      <span class="sidebar-toggle-line sidebar-toggle-line-first"></span>
      <span class="sidebar-toggle-line sidebar-toggle-line-middle"></span>
      <span class="sidebar-toggle-line sidebar-toggle-line-last"></span>
    </div>
  </div>

  <aside id="sidebar" class="sidebar">
    
    <div class="sidebar-inner">

      

      

      <section class="site-overview-wrap sidebar-panel sidebar-panel-active">
        <div class="site-overview">
          <div class="site-author motion-element" itemprop="author" itemscope itemtype="http://schema.org/Person">
            
              <p class="site-author-name" itemprop="name">Nonewood</p>
              <p class="site-description motion-element" itemprop="description"></p>
          </div>

          <nav class="site-state motion-element">

            
              <div class="site-state-item site-state-posts">
              
                <a href="/archives/">
              
                  <span class="site-state-item-count">83</span>
                  <span class="site-state-item-name">日志</span>
                </a>
              </div>
            

            
              
              
              <div class="site-state-item site-state-categories">
                <a href="/categories/index.html">
                  <span class="site-state-item-count">3</span>
                  <span class="site-state-item-name">分类</span>
                </a>
              </div>
            

            
              
              
              <div class="site-state-item site-state-tags">
                <a href="/tags/index.html">
                  <span class="site-state-item-count">49</span>
                  <span class="site-state-item-name">标签</span>
                </a>
              </div>
            

          </nav>

          

          

          
          

          
          

          

        </div>
      </section>

      

      

      <script async src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
      <!-- 侧边广告 -->
      <ins class="adsbygoogle" style="display:block" data-ad-client="ca-pub-7093029654692281" data-ad-slot="4703719462" data-ad-format="auto" data-full-width-responsive="true"></ins>
     <script>
     (adsbygoogle = window.adsbygoogle || []).push({});
     </script>
    </div>
  </aside>


        
      </div>
    </main>

    <footer id="footer" class="footer">
      <div class="footer-inner">
        <script async src="//busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js"></script>
<div class="copyright">&copy; <span itemprop="copyrightYear">2022</span>
  <span class="with-love">
    <i class="fa fa-user"></i>
  </span>
  <span class="author" itemprop="copyrightHolder">Nonewood</span>

  
    <span class="post-meta-divider">|</span>
    <span class="post-meta-item-icon">
      <i class="fa fa-area-chart"></i>
    </span>
    
      <span class="post-meta-item-text">Site words total count&#58;</span>
    
    <span title="Site words total count">139k</span>
  
</div>


  <div class="powered-by">由 <a class="theme-link" target="_blank" href="https://hexo.io">Hexo</a> 强力驱动</div>



  <span class="post-meta-divider">|</span>



  <div class="theme-info">主题 &mdash; <a class="theme-link" target="_blank" href="https://github.com/iissnan/hexo-theme-next">NexT.Pisces</a> v5.1.4</div>




        
<div class="busuanzi-count">
  <script async src="https://dn-lbstatics.qbox.me/busuanzi/2.3/busuanzi.pure.mini.js"></script>

  
    <span class="site-uv">
      <i class="fa fa-user"></i>
      <span class="busuanzi-value" id="busuanzi_value_site_uv"></span>
      
    </span>
  

  
    <span class="site-pv">
      <i class="fa fa-eye"></i>
      <span class="busuanzi-value" id="busuanzi_value_site_pv"></span>
      
    </span>
  
</div>








        
      </div>
    </footer>

    
      <div class="back-to-top">
        <i class="fa fa-arrow-up"></i>
        
      </div>
    

    

  </div>

  

<script type="text/javascript">
  if (Object.prototype.toString.call(window.Promise) !== '[object Function]') {
    window.Promise = null;
  }
</script>









  












  
  
    <script type="text/javascript" src="/lib/jquery/index.js?v=2.1.3"></script>
  

  
  
    <script type="text/javascript" src="/lib/fastclick/lib/fastclick.min.js?v=1.0.6"></script>
  

  
  
    <script type="text/javascript" src="/lib/jquery_lazyload/jquery.lazyload.js?v=1.9.7"></script>
  

  
  
    <script type="text/javascript" src="/lib/velocity/velocity.min.js?v=1.2.1"></script>
  

  
  
    <script type="text/javascript" src="/lib/velocity/velocity.ui.min.js?v=1.2.1"></script>
  

  
  
    <script type="text/javascript" src="/lib/fancybox/source/jquery.fancybox.pack.js?v=2.1.5"></script>
  


  


  <script type="text/javascript" src="/js/src/utils.js?v=5.1.4"></script>

  <script type="text/javascript" src="/js/src/motion.js?v=5.1.4"></script>



  
  


  <script type="text/javascript" src="/js/src/affix.js?v=5.1.4"></script>

  <script type="text/javascript" src="/js/src/schemes/pisces.js?v=5.1.4"></script>



  

  


  <script type="text/javascript" src="/js/src/bootstrap.js?v=5.1.4"></script>



  


  




	





  





  












  





  

  

  

  
  

  

  

  

  

  <script async src="/js/src/fireworks.js"></script>



 
<script>
  var OriginTitile = document.title;
  var titleTime;
  document.addEventListener("visibilitychange", function() {
    if (document.hidden) {
      document.title = "(つェ⊂)我藏好了哦~" + OriginTitile;
      clearTimeout(titleTime);
    } else {
      document.title = "(*´∇｀*) 被你发现啦~" + OriginTitile;
      titleTime = setTimeout(function() {
        document.title = OriginTitile;
      }, 2000);
    }
  });
</script>


 
<script src="https://cdn.jsdelivr.net/npm/moment@2.22.2/moment.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/moment-precise-range-plugin@1.3.0/moment-precise-range.min.js"></script>
<script>
  function timer() {
    var ages = moment.preciseDiff(moment(),moment(20190801,"YYYYMMDD"));
    ages = ages.replace(/years?/, "年");
    ages = ages.replace(/months?/, "月");
    ages = ages.replace(/days?/, "天");
    ages = ages.replace(/hours?/, "小时");
    ages = ages.replace(/minutes?/, "分");
    ages = ages.replace(/seconds?/, "秒𓃗𓃵𓆉𓇼𓆡");
    ages = ages.replace(/\d+/g, '<span style="color:">$&</span>');
    div.innerHTML = `𓃠𓃰𓃱𓃲𓃟 ${ages}`;
  }
  var div = document.createElement("div");
  //插入到copyright之后
  var copyright = document.querySelector(".copyright");
  document.querySelector(".footer-inner").insertBefore(div, copyright.nextSibling);
  timer();
  setInterval("timer()",1000)
</script>


</body>
</html>
